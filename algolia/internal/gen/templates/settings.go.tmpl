// Code generated by go generate. DO NOT EDIT.

package search

import (
    "encoding/json"
    "fmt"
    "strings"

    "github.com/algolia/algoliasearch-client-go/v3/algolia/debug"
    "github.com/algolia/algoliasearch-client-go/v3/algolia/opt"
)

// Settings represents an index settings configuration.
type Settings struct {
    {{- range $_, $setting := . }}
    {{ title $setting.Name }} *opt.{{ title $setting.Name }}Option `json:"{{ $setting.Name }},omitempty"`
    {{- end }}
    RenderingContent *RenderingContent `json:"renderingContent,omitempty"`
    Extensions *Extensions `json:"extensions,omitempty"`
    CustomSettings map[string]interface{} `json:"-"`
}

type settings Settings

type backwardCompatibleSettings struct {
    {{- range $_, $setting := . -}}
    {{ if $setting.BackwardCompatibleAlternative }}
    {{ title $setting.BackwardCompatibleAlternative }} *opt.{{ title $setting.Name }}Option `json:"{{ $setting.BackwardCompatibleAlternative }},omitempty"`
    {{- end }}
    {{- end }}
}

func (s *Settings) UnmarshalJSON(data []byte) error {
    var bcSettings backwardCompatibleSettings
    err := json.Unmarshal(data, &bcSettings)
    if err != nil {
        return fmt.Errorf("cannot unmarshal backward-compatible settings: %v", err)
    }

    err = json.Unmarshal(data, (*settings)(s))
    if err != nil {
        return fmt.Errorf("cannot unmarshal settings: %v", err)
    }

    {{ range $_, $setting := . -}}
    {{ if $setting.BackwardCompatibleAlternative }}
    if s.{{ title $setting.Name }} == nil{
        s.{{ title $setting.Name }} = bcSettings.{{ title $setting.BackwardCompatibleAlternative }}
    }
    {{ end }}
    {{- end }}

    err = json.Unmarshal(data, &s.CustomSettings)
    if err != nil {
        return fmt.Errorf("cannot unmarshal unknown settings: %v", err)
    }
    for _, knownSetting := range []string{
        {{- range $_, $setting := . }}
        "{{ $setting.Name }}",
        {{- if $setting.BackwardCompatibleAlternative }}
        "{{ $setting.BackwardCompatibleAlternative }}",
        {{- end }}
        {{- end }}
    } {
        delete(s.CustomSettings, knownSetting)
    }

    return nil
}

func (s Settings) MarshalJSON() ([]byte, error) {
	dataWithoutCustomSettings, err := json.Marshal(settings(s))
	if err != nil {
		return nil, fmt.Errorf("cannot marshal known settings: %v", err)
    }
	var m map[string]json.RawMessage
	err = json.Unmarshal(dataWithoutCustomSettings, &m)
	if err != nil {
		return nil, fmt.Errorf("cannot unmarshal known settings into temporary map: %v", err)
    }
	for k, v := range s.CustomSettings {
		data, err := json.Marshal(v)
		if err != nil {
			return nil, fmt.Errorf("cannot marshal unknown settings %q: %v", k, err)
        }
		m[k] = data
    }
	return json.Marshal(m)
}

// Equal returns true if given settings are the same as the instance one. Empty
// settings are considered equal to their default value counterpart.
func (s Settings) Equal(s2 Settings) bool {
    {{- range $_, $setting := . }}
    if !opt.{{ title $setting.Name }}Equal(s.{{ title $setting.Name}}, s2.{{ title $setting.Name }}) {
        debug.Printf("Settings.{{ title $setting.Name }} are not equal: %#v != %#v\n", s.{{ title $setting.Name }}, s2.{{ title $setting.Name }})
        return false
    }
    {{- end }}
    return true
}

func (s Settings) String() string {
    settingsStr := "Settings{\n"
    {{- range $_, $setting := . }}
    settingsStr += fmt.Sprintf("\t{{ title $setting.Name }}: %v,\n", stringifyReturnValues(s.{{ title $setting.Name }}.Get()))
    {{- end }}

    settingsStr += fmt.Sprintf("\tRenderingContent: %+v\n", s.RenderingContent)

    settingsStr += "\tCustomSettings{\n"
    for k, v := range s.CustomSettings {
        settingsStr += fmt.Sprintf("\t\t%s: %v,\n", k, v)
    }
    settingsStr += "\t},\n}"

    return settingsStr
}

func stringifyReturnValues(args ...interface{}) string {
	var s []string
	for _, arg := range args {
		s = append(s, fmt.Sprintf("%v", arg))
    }
	return "(" + strings.Join(s, ",") + ")"
}