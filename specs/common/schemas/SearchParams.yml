searchParams:
  oneOf:
    - $ref: '#/searchParamsString'
    - $ref: '#/searchParamsObject'

searchParamsObject:
  allOf:
    - $ref: '#/baseSearchParams'
    - $ref: '../../common/schemas/IndexSettings.yml#/indexSettingsAsSearchParams'

baseSearchParams:
  allOf:
    - $ref: '#/searchParamsQuery'
    - $ref: '#/baseSearchParamsWithoutQuery'

searchParamsQuery:
  type: object
  additionalProperties: false
  properties:
    query:
      $ref: '#/query'

baseSearchParamsWithoutQuery:
  type: object
  additionalProperties: false
  properties:
    similarQuery:
      type: string
      description: Overrides the query parameter and performs a more generic search that can be used to find "similar" results.
      default: ''
      x-categories:
        - Search
    filters:
      $ref: '#/filters'
    facetFilters:
      $ref: '#/facetFilters'
    optionalFilters:
      $ref: '#/optionalFilters'
    numericFilters:
      $ref: '#/numericFilters'
    tagFilters:
      $ref: '#/tagFilters'
    sumOrFiltersScores:
      type: boolean
      description: Determines how to calculate the total score for filtering.
      default: false
      x-categories:
        - Filtering
    facets:
      type: array
      items:
        type: string
      description: Retrieve facets and their facet values.
      default: []
      x-categories:
        - Faceting
    maxValuesPerFacet:
      type: integer
      description: Maximum number of facet values to return for each facet during a regular search.
      default: 100
      x-categories:
        - Faceting
    facetingAfterDistinct:
      type: boolean
      description: Force faceting to be applied after de-duplication (via the Distinct setting).
      default: false
      x-categories:
        - Faceting
    sortFacetValuesBy:
      type: string
      description: Controls how facet values are fetched.
      default: count
      x-categories:
        - Faceting
    page:
      $ref: '#/page'
    offset:
      type: integer
      description: Specify the offset of the first hit to return.
      x-categories:
        - Pagination
    length:
      type: integer
      description: Set the number of hits to retrieve (used only with offset).
      minimum: 1
      maximum: 1000
      x-categories:
        - Pagination
    aroundLatLng:
      $ref: '#/aroundLatLng'
    aroundLatLngViaIP:
      $ref: '#/aroundLatLngViaIP'
    aroundRadius:
      $ref: '#/aroundRadius'
    aroundPrecision:
      type: integer
      description: Precision of geo search (in meters), to add grouping by geo location to the ranking formula.
      default: 10
      x-categories:
        - Geo-Search
    minimumAroundRadius:
      type: integer
      description: Minimum radius (in meters) used for a geo search when aroundRadius is not set.
      minimum: 1
      x-categories:
        - Geo-Search
    insideBoundingBox:
      $ref: '#/insideBoundingBox'
    insidePolygon:
      $ref: '#/insidePolygon'
    naturalLanguages:
      type: array
      items:
        type: string
      description: This parameter changes the default values of certain parameters and settings that work best for a natural language query, such as ignorePlurals, removeStopWords, removeWordsIfNoResults, analyticsTags and ruleContexts. These parameters and settings work well together when the query is formatted in natural language instead of keywords, for example when your user performs a voice search.
      default: []
      x-categories:
        - Languages
    ruleContexts:
      type: array
      items:
        type: string
      description: Enables contextual rules.
      default: []
      x-categories:
        - Rules
    personalizationImpact:
      type: integer
      description: Define the impact of the Personalization feature.
      default: 100
      x-categories:
        - Personalization
    userToken:
      type: string
      description: Associates a certain user token with the current search.
      x-categories:
        - Personalization
    getRankingInfo:
      type: boolean
      description: Retrieve detailed ranking information.
      default: false
      x-categories:
        - Advanced
    clickAnalytics:
      type: boolean
      description: Enable the Click Analytics feature.
      default: false
      x-categories:
        - Analytics
    analytics:
      type: boolean
      description: Whether the current query will be taken into account in the Analytics.
      default: true
      x-categories:
        - Analytics
    analyticsTags:
      type: array
      items:
        type: string
      description: List of tags to apply to the query for analytics purposes.
      default: []
      x-categories:
        - Analytics
    percentileComputation:
      type: boolean
      description: Whether to include or exclude a query from the processing-time percentile computation.
      default: true
      x-categories:
        - Advanced
    enableABTest:
      type: boolean
      description: Whether this search should participate in running AB tests.
      default: true
      x-categories:
        - Advanced
    enableReRanking:
      type: boolean
      description: Whether this search should use AI Re-Ranking.
      default: true
      x-categories:
        - Advanced
    reRankingApplyFilter:
      $ref: '#/reRankingApplyFilter'

searchParamsString:
  type: object
  additionalProperties: false
  properties:
    params:
      $ref: '#/paramsAsString'

paramsAsString:
  description: Search parameters as URL-encoded query string.
  type: string
  default: ''

query:
  type: string
  description: The text to search in the index.
  default: ''
  x-categories:
    - Search

page:
  type: integer
  description: Specify the page to retrieve.
  default: 0
  x-categories:
    - Pagination

aroundRadius:
  description: Define the maximum radius for a geo search (in meters).
  oneOf:
    - type: integer
      minimum: 1
    - $ref: '#/aroundRadiusAll'
  x-categories:
    - Geo-Search

aroundRadiusAll:
  type: string
  enum: [all]

aroundLatLng:
  type: string
  description: Search for entries around a central geolocation, enabling a geo search within a circular area.
  default: ''
  x-categories:
    - Geo-Search

aroundLatLngViaIP:
  type: boolean
  description: Search for entries around a given location automatically computed from the requester's IP address.
  default: false
  x-categories:
    - Geo-Search

insideBoundingBox:
  type: array
  items:
    type: number
    format: double
  description: Search inside a rectangular area (in geo coordinates).
  x-categories:
    - Geo-Search

insidePolygon:
  type: array
  items:
    type: number
    format: double
  description: Search inside a polygon (in geo coordinates).
  x-categories:
    - Geo-Search

# There is duplicated logic here because we want to keep a correct description
# and using `$ref` override everything.
searchFiltersArrayString:
  type: array
  items:
    type: string

mixedSearchFilters:
  oneOf:
    - $ref: '#/searchFiltersArrayString'
    - type: string

listOfSearchFilters:
  type: array
  items:
    $ref: '#/mixedSearchFilters'

filters:
  type: string
  description: Filter the query with numeric, facet and/or tag filters.
  default: ''
  x-categories:
    - Filtering

facetFilters:
  description: Filter hits by facet value.
  oneOf:
    - $ref: '#/listOfSearchFilters'
    - type: string
  x-categories:
    - Filtering

reRankingApplyFilter:
  description: When Dynamic Re-Ranking is enabled, only records that match these filters will be impacted by Dynamic Re-Ranking.
  nullable: true
  oneOf:
    - $ref: '#/listOfSearchFilters'
    - type: string
  x-categories:
    - Filtering

tagFilters:
  description: Filter hits by tags.
  oneOf:
    - $ref: '#/listOfSearchFilters'
    - type: string
  x-categories:
    - Filtering

numericFilters:
  description: Filter on numeric attributes.
  oneOf:
    - $ref: '#/listOfSearchFilters'
    - type: string
  x-categories:
    - Filtering

optionalFilters:
  description: Create filters for ranking purposes, where records that match the filter are ranked higher, or lower in the case of a negative optional filter.
  oneOf:
    - $ref: '#/listOfSearchFilters'
    - type: string
  x-categories:
    - Filtering
