---
title: Migration guide
---

:::warning

The amount of changes in this new version is significant. If you were using a version older than v4, please also read [this migration guide](https://www.algolia.com/doc/api-client/getting-started/upgrade-guides/javascript/).

**You should thoroughly test your application before deploying to production.**

:::

import { TabsLanguage } from '../../../src/components/TabsLanguage';
import TabItem from '@theme/TabItem';

This document lists every known breaking change, not all of them may affect your application.

## Common breaking changes

> The changes below are effective on all of the API clients.

<table width="100%"><tbody><tr><td width="400px" valign="top">

### `initIndex`

<hr />

Methods previously available at the `initIndex` level are now available at the `root` level of the API client.

The `indexName` parameter is now **required** when calling those methods.

</td><td width="600px">

<TabsLanguage>
<TabItem value="javascript">

```js
import { algoliasearch } from '@experimental-api-clients-automation/algoliasearch';

const client = algoliasearch('<YOUR_APP_ID>', '<YOUR_API_KEY>');

const searchResults2 = await client.search({
  requests: [
    {
      indexName: '<YOUR_INDEX_NAME>',
      query: '<YOUR_QUERY>',
      attributesToRetrieve: ['firstname', 'lastname'],
      hitsPerPage: 50,
    },
  ],
});
```

</TabItem>
<TabItem value="php">

```php
$client = Algolia\AlgoliaSearch\Api\SearchClient::create(
    '<YOUR_APP_ID>',
    '<YOUR_API_KEY>'
);

$client->search([
    'requests' => [
        [
            'indexName' => '<YOUR_INDEX_NAME>',
            'query' => '<YOUR_QUERY>',
            'attributesToRetrieve' => ['firstname', 'lastname'],
            'hitsPerPage': 50,
        ],
    ],
]);
```

</TabItem>
<TabItem value="java">

```java
import com.algolia.model.search.*;

SearchClient client = new SearchClient(
  "<YOUR_APP_ID>",
  "<YOUR_API_KEY>"
);

client.search(
  new SearchMethodParams()
    .addRequests(SearchQuery.of(
      new SearchForHits()
        .setIndexName("<YOUR_INDEX_NAME>")
        .setQuery("<YOUR_QUERY>")
        .addAttributesToRetrieve("firstname")
        .addAttributesToRetrieve("lastname")
        .setHitsPerPage(50)
    )
  )
);
```

</TabItem>
</TabsLanguage>

</td></tr></tbody></table>

<table width="100%"><tbody><tr><td width="400px" valign="top">

### A/B testing client

<hr />

The A/B testing methods were previously available under the `Analytics` client, we've decided to make a client out of it to split concerns.

The `Abtesting` client now hosts all of the `A/B testing` related methods.

</td><td width="600px">

<TabsLanguage>
<TabItem value="javascript">

```js {2-3}
import { abtestingClient } from '@experimental-api-clients-automation/client-abtesting';

- const analyticsClient = algoliasearch('<YOUR_APP_ID>', '<YOUR_API_KEY>').initAnalytics();
+ const client = abtestingClient('<YOUR_APP_ID>', '<YOUR_API_KEY>');

const searchResults2 = await client.search({
  requests: [
    {
      indexName: '<YOUR_INDEX_NAME>',
      query: '<YOUR_QUERY>',
      attributesToRetrieve: ['firstname', 'lastname'],
      hitsPerPage: 50,
    },
  ],
});
```

</TabItem>
<TabItem value="php">

```php
// TODO
```

</TabItem>
<TabItem value="java">

```java
// TODO

```

</TabItem>
</TabsLanguage>

</td></tr></tbody></table>

<table width="100%"><tbody><tr><td width="400px" valign="top">

### `wait`

<hr />

The chainable `wait` method that was available on a few methods has been replaced with an helper called `waitForTask`.

You can now optionally configure how the wait logic behaves by passing the `taskID` returned when calling the Algolia API.

[Read more in our dedicated guide](/docs/clients/guides/wait-for-a-task-to-finish)

</td><td width="600px">

<TabsLanguage>
<TabItem value="javascript">

```js
import { algoliasearch } from '@experimental-api-clients-automation/algoliasearch';

const client = algoliasearch('<YOUR_APP_ID>', '<YOUR_API_KEY>');

const { taskID } = await client.saveObject({
  indexName: '<YOUR_INDEX_NAME>',
  body: {
    title: 'My Algolia Object',
  },
});

// Poll the task status with defaults values
await client.waitForTask({ indexName: '<YOUR_INDEX_NAME>', taskID });
```

</TabItem>
<TabItem value="php">

```php
$client = SearchClient::create(
    '<YOUR_APP_ID>',
    '<YOUR_APP_ID>'
);

$response = $client->saveObject(
    '<YOUR_INDEX_NAME>',
    ['title' => "My Algolia Object"],
);

// Poll the task status with defaults values
$client->waitForTask('<YOUR_INDEX_NAME>', $response['taskID']);
```

</TabItem>
<TabItem value="java">

```java
import com.algolia.model.search.*;

Map<String, Object> body = new HashMap<>();
body.put("title", "My Algolia Object");
SaveObjectResponse response = client.saveObject(
  "<YOUR_INDEX_NAME>",
  body
);

// Poll the task status with defaults values
client.waitForTask("<YOUR_INDEX_NAME>", response.getTaskID());
```

</TabItem>
</TabsLanguage>

</td></tr></tbody></table>

<table width="100%"><tbody><tr><td width="400px" valign="top">

### `moveIndex`/`copyIndex`

<hr />

The `operationIndex` allows you to either `copy` or `move` a `source` index to a `destination` index **within the same Algolia application**.

You can also decide what `scope` of the `source` index should be copied, [read more in our dedicated guide](/docs/clients/guides/copy-or-move-index).

</td><td width="600px">

<TabsLanguage>
<TabItem value="javascript">

```js
import { algoliasearch } from '@experimental-api-clients-automation/algoliasearch';

const client = algoliasearch('<YOUR_APP_ID>', '<YOUR_API_KEY>');

const { taskID } = await client.operationIndex({
  indexName: '<SOURCE_INDEX_NAME>',
  operationIndexParams: {
    // Enum for either `copy` or `move`
    operation: 'copy', // 'move'
    destination: '<DESTINATION_INDEX_NAME>',
  },
});

// Poll the task status until it's done
await client.waitForTask({ indexName: '<SOURCE_INDEX_NAME>', taskID });
```

</TabItem>
<TabItem value="php">

```php
$client = SearchClient::create(
    '<YOUR_APP_ID>',
    '<YOUR_APP_ID>'
);

$response = $client->operationIndex(
    '<SOURCE_INDEX_NAME>',
    [
        // Enum for either `copy` or `move`
        'operation' => 'copy', // 'move'
        'destination' => '<DESTINATION_INDEX_NAME>'
    ]
);

// Poll the task status until it's done
$client->waitForTask('<SOURCE_INDEX_NAME>', $response['taskID']);
```

</TabItem>
<TabItem value="java">

```java
import com.algolia.model.search.*;

UpdatedAtResponse response = client.operationIndex(
  "<SOURCE_INDEX_NAME>",
  new OperationIndexParams()
    .setOperation(OperationType.COPY) // or MOVE
    .setDestination("<DESTINATION_INDEX_NAME>")
);

// Poll the task status until it's done
client.waitForTask("<SOURCE_INDEX_NAME>", response.getTaskID());
```

</TabItem>
</TabsLanguage>

</td></tr></tbody></table>

<table width="100%"><tbody><tr><td width="400px" valign="top">

### `saveObjects`

<hr />

The `saveObjects` method has been removed, you can leverage the already existing `batch` method instead.

[Read more in our dedicated guide](/docs/clients/guides/send-data-to-algolia) or [the API reference](/specs/search/#tag/Records/operation/batch).

</td><td width="600px">

<TabsLanguage>
<TabItem value="javascript">

```js
// The records retrieved by any of your data sources
const recordsFromDataSource = [
  { name: 'Tom Cruise' },
  { name: 'Scarlett Johansson' },
];

// Here we construct the request to be sent to Algolia with the `batch` method
const requests: BatchOperation[] = recordsFromDataSource.map((record) => {
  return {
    // `batch` allows you to do many Algolia operations, but here we want to index our record.
    action: 'addObject',
    body: record,
  };
});

await client.batch({
  indexName: '<YOUR_INDEX_NAME>',
  batchWriteParams: {
    requests,
  },
});
```

</TabItem>
<TabItem value="php">

```java
// The records retrieved by any of your data sources
$records = [
    ['name' => 'Tom Cruise'],
    ['name' => 'Scarlett Johansson']
];

// Here we construct the request to be sent to Algolia with the `batch` method
$requests = [];

foreach ($records as $record) {
    $requests += [
      'action' => 'addObject',
      'body' => $record
    ];
}

$client->batch(
    '<YOUR_INDEX_NAME>',
    [ 'requests' => $requests ]
);
```

</TabItem>
<TabItem value="java">

```java
class Actor {
  String name;

  Actor(String name) {
    this.name = name;
  }
}

// The records retrieved by any of your data sources
List<Actor> records = Arrays.asList(
  new Actor("Tom Cruise"),
  new Actor("Scarlett Johansson")
);

// Here we construct the request to be sent to Algolia with the `batch` method
List<BatchOperation> requests = new ArrayList<>();

for (Actor record : records) {
  requests.add(new BatchOperation()
    .setAction(Action.ADD_OBJECT)
    // Accepts any serializable class.
    .setBody(record)
  );
}

client.batch("<YOUR_INDEX_NAME>", new BatchWriteParams().setRequests(batch));

```

</TabItem>
</TabsLanguage>

</td></tr></tbody></table>

## Client's specific breaking changes

You can find specific client breaking changes in their own section:

- [JavaScript migration guide](/docs/clients/migration-guides/javascript)
- [PHP migration guide](/docs/clients/migration-guides/php)
- [Java migration guide](/docs/clients/migration-guides/java)
